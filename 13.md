## 13.2 TFRecord 포맷

- 대용량 데이터를 저장하고 효율적으로 읽기 위해 텐서플로가 선호하는 포맷
- 크기가 다른 연속된 이진 레코드를 저장하는 단순한 이진 포맷

###  13.2.1 압축된 TFRecord 파일

- 네트워크를 통해 읽어들여야 할 경우, 압축의 필요가 있음.
- options 매개변수를 활용하여 압축이 가능하다.
  - 압축된 것을 읽을 때 압축방식을 지정해주어야 한다.

### 13.2.2 프로토콜 버퍼 개요

- TFRecord는 직렬화된 프로토콜 버퍼를 담고 있다.
  - 프로토콜 버퍼 : 구글이 개발한 확장성 좋고 효율적인 이진 포맷.
- 일반적인 버퍼의 파싱연산은 텐서플로 연산이 아니여서 코드가 느리고 이식성이 떨어짐
  - 텐서플로는 특별한 프로토콜 버퍼 정의를 통해 파싱연산을 제공할 수 있음.

### 13.2.3 텐서플로 프로토콜 버퍼

- 데이터셋에 있는 하나의 샘플을 표현하는 Example 프로토콜 버퍼가 전형적인 주요 프로토콜 버퍼
  - 이를 파싱하는 함수는 텐서플로 연산이므로 TF 함수에 포함할 수 있다.
  - 대부분 Example로 충분하지만, 리스트의 리스트(텍스트 문서 같은 것)를 다룰 땐 SequenceExample을 쓴다.

## 13.3 입력 특성 전처리

- 신경망에 데이터를 넣으려면 일단 모든 것을 수치화하고 정규화 해야한다.
- 전처리 층을 모델에 직접 포함시킬수도 있음.

### 13.3.1 원-핫벡터 이용하기

- 범주의 개수가 크지않다면 원 핫인코딩을 쓰는 것이 용이함.
- oov 버킷을 사용하여 자주바뀌는 범주나 너무 많은 범주에 대응한다.
  - 알려지지 않은 범주를 oov 버킷에 추가하며, 버킷이 충분하지 않으면 문제가 생긴다.
  - 어휘 사전이 너무 크면 임베딩을 사용하는 것이 더 효율적이다.

### 13.3.2 임베딩을 활용하여 범주형 특성 인코딩

- 다차원으로 벡터화하는 방식
- 비슷한 범주일 수록 경사하강법에 의해 더 가까운 거리
- 표현학습 : 범주가 유용하게 표현되도록 임베딩이 훈련되는 경향
- 단어임베딩 : 벡터로 단어를 표현하여 어떠한 의미의 개념을 담을 수 있음.

![그래픽 | DBR](https://dbr.donga.com/graphic/read_image?file_path=/data/dbr/uploads/graphic/2018/11/400fd47a9f12748eef282e651ef4c740.jpg)

### 13.3.3 케라스 전처리 층

- 표준 케라스 전처리 층을 제공이 되고있는 중.
- 앞서 배운 Normalization과 TextVectorization 이 대표적인 전처리층
- Discretization은 연속형을 범주로 나누고 원핫 벡터로 인코딩한다.
- PreprocessingStage 클래스를 통해 여러 전처리층을 연결
- 훈련과 동시에 진행할 수도 있으나, 보통 처리 비용이 매우 크므로 훈련이전에 사전에 다 돌려놓는 것이 속도개선에 좋을 수 있다.
  - 훈련하기 전에 샘플마다 한번씩 전처리 미리하기

## 13.4 TF 변환

- 모델 배포 이후 전처리 코드가 어플리케이션에 추가되어야 한다면?
- 기존 훈련때의 전처리와 배포이후의 전처리 코드 과정이 달라 유지보수가 어려움
- TF변환을 통해 전처리 함수를 딱 한번만 정의해서 그 것을 배포할 모델에서도 동일하게 사용할 수 있도록 한다.

## 13.5 텐서플로 데이터셋 프로젝트

- 널리 사용되는 표준 데이터셋 제공
- 텐서플로 기본제공은 아니므로 pip를 통해 다운로드가 필요하다.